
{% load template_tags %}
<div class="detailHead">
    <span class="hedText">{{extra_context|displayValue:'institutionType'}} Form</span>
</div>
<form action="." method="POST" enctype="multipart/form-data" id="institutionForm" onsubmit="return false;">{% csrf_token %}
    {{form.management_form}}
    <input type="hidden" name="form-buttonType" id="id_form-buttonType" value="save" />
    <input type="hidden" id="url" value="/institution/{{institution.id}}/update/" />
    <input type="hidden" id="institution_id" value="{{institution.id}}" />
    <input type="hidden" id="success_status" size="15" value="{{extra_context|displayValue:'showsuccess'}}" / >
    {% with form.forms|last as entryForm %}
        <div>
            <label class="KLP_required">Name:</label>
            <!-- Name Field -->
            <input id="id_form-0-name" maxlength="300" name="form-0-name" tabindex="1" type="text" class="form-control" value="{{institution.name}}">
            <!-- If Name field has errors show errors -->
            {% for error in entryForm.name.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label>Category:</label>
             <!-- Category Field -->
            <select id="id_form-0-cat" name="form-0-cat" tabindex=2 class="form-control">
                {% for category in extra_context|displayValue:'categoryList' %}
                    {% if extra_context|displayValue:'selCategoryTyp' == category.id or institution.cat.id == category.id %}
                        <option value="{{category.id}}" selected="true">{{category.name}}</option>
                    {% else %}
                        <option value="{{category.id}}">{{category.name}}</option>
                    {% endif %}
                {% endfor %}
            </select>

            <!-- If Category field has errors show errors -->
            {% for error in entryForm.cat.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label class="KLP_required">{{extra_context|displayValue:'institutionType'}} Gender:</label></td>
            <!-- Instituion Gender Field -->
            <select id="id_form-0-institution_gender" name="form-0-institution_gender" tabindex="3" class="form-control">
                <option value="boys">boys</option>
                <option value="girls">girls</option>
                <option value="co-ed" selected="selected">co-ed</option>
            </select>
            <!-- If Instituion Gender field has errors show errors -->
             {% for error in entryForm.institution_gender.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label>Dise Code:</label></td>
            <!-- Dise Code Field -->
            <input id="id_form-0-dise_code" maxlength="14" name="form-0-dise_code" tabindex="4" type="text" class="form-control">
            <!-- If Dise Code field has errors show errors -->
            {% for error in entryForm.dise_code.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label class="KLP_required">Language:</label>
            <!-- Language Field -->
            <select multiple="multiple" id="id_form-0-languages" name="form-0-languages" tabindex="5" class="form-control">
                <option value="1">kannada</option>
                <option value="2">urdu</option>
                <option value="3">tamil</option>
                <option value="4">telugu</option>
                <option value="5">english</option>
                <option value="6">marathi</option>
                <option value="7">hindi</option>
                <option value="8">konkani</option>
                <option value="9">sindhi</option>
                <option value="10">other</option>
                <option value="11">gujarathi</option>
                <option value="12">not known</option>
                <option value="13">multi lng</option>
                <option value="14">nepali</option>
                <option value="15">oriya</option>
                <option value="16">bengali</option>
                <option value="17">malayalam</option>
                <option value="18">sanskrit</option>
            </select>
            <!-- If Language field has errors show errors -->
            {% for error in entryForm.languages.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label class="KLP_required">Management:</label>
            <!-- Management Field -->
            <select id="id_form-0-mgmt" name="form-0-mgmt" tabindex="6" class="form-control">
                <option value="1" selected="selected">ed</option>
                <option value="2">swd</option>
                <option value="3">local</option>
                <option value="4">p-a</option>
                <option value="5">p-ua</option>
                <option value="6">others</option>
                <option value="7">approved</option>
                <option value="8">ssa</option>
                <option value="9">kgbv</option>
                <option value="10">p-a-sc</option>
                <option value="11">p-a-st</option>
                <option value="12">jawahar</option>
                <option value="13">central</option>
                <option value="14">sainik</option>
                <option value="15">central govt</option>
                <option value="16">nri</option>
                <option value="17">madrasa-a</option>
                <option value="18">madrasa-ua</option>
                <option value="19">arabic-a</option>
                <option value="20">arabic-ua</option>
                <option value="21">sanskrit-a</option>
                <option value="22">sanskrit-ua</option>
                <option value="23">p-ua-sc</option>
                <option value="24">p-ua-st</option>
            </select>
            <!-- If Management field has errors show errors -->
            {% for error in entryForm.mgmt.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label class="KLP_required">Address:</label>
            <!-- Address Field -->
            <textarea name="form-0-address" id="id_form-0-address" rows="4" cols="20" tabindex=7 class="form-control">{{institution.inst_address.address}}</textarea>
             <!-- If address field has errors show errors -->
            {% for error in entryForm.address.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label>Area:</label>
            <!-- Area Field -->
            <textarea name="form-0-area" id="id_area" rows="4" cols="20" tabindex=8 class="form-control">{{institution.inst_address.area}}</textarea>
            <!-- If area field has errors show errors -->
            {% for error in entryForm.area.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label>Pincode:</label>
            <!-- Pincode Field -->
            <input type="text" name="form-0-pincode" id="id_pincode" size="15" value='{{institution.inst_address.pincode}}' tabindex=9 class="form-control" />
            <!-- If pincode field has errors show errors -->
            {% for error in entryForm.pincode.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label>Landmark:</label>
            <!-- Landmark Field -->
            <textarea name="form-0-landmark" id="id_form-0-landmark" rows="4" cols="20" tabindex=10 class="form-control">{{institution.inst_address.landmark}} </textarea>
            <!-- If landmark field has errors show errors -->
            {% for error in entryForm.landmark.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label>Identifications:</label>
            <!-- Identification Field -->
            <input type="text" name="form-0-instidentification" id="id_instidentification" size="15" value='{{institution.inst_address.instidentification}}' tabindex=11 class="form-control" />
            <!-- If Identification field has errors show errors -->
            {% for error in entryForm.instidentification.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <label>Route Information:</label>
            <!-- Route Information Field -->
            <input type="text" name="form-0-route_information" id="id_route_information" size="15" value='{{institution.inst_address.route_information}}' tabindex=12 class="form-control" />
            <!-- If route_information field has errors show errors -->
            {% for error in entryForm.route_information.errors %}
                <span class="editErr">{{ error }}</span>
            {% endfor %}
            <br>

            <span style="display:none">
                <input type="hidden" name="form-0-boundary" id="id_form-0-boundary" size="15" value='{{institution.boundary.id}}'/>
                <input type="hidden" name="parentId" value="{{institution.boundary.id}}" id="parentId" />
                <input type="hidden" id="id_form-0-active" name="form-0-active" value="2">
                {{entryForm.id}}
            </span>
            <button type="submit" name="save" id="id_save" value="Save" tabindex=10 class="btn btn-default">Save</button>
        </div>
    {% endwith %}
</form>


<script>

$(document).ready(function(){

   $("#id_save").click(function(){
   	/* Clicking on save button hide all prv msgs and call form submit and pass button type is save */
   	KLP_Hide_Msg();
   	parentVal = $("#id_form-0-boundary").val();
   	$("#id_form-buttonType").val('save');
   	KLP_form_submit(parentVal);

   });

   $("#id_save_and_continue").click(function(){
   	/* Clicking on save and continue button hide all prv msgs and call form submit and pass button type is save and continue */
   	KLP_Hide_Msg();
   	$("#id_form-buttonType").val('save and continue');
   	parentVal = $("#id_form-0-boundary").val();
   	KLP_form_submit(parentVal);

   });

   $("#id_save_and_create").click(function(){
   	/* Clicking on save and add another button hide all prv msgs and call form submit and pass button type is save and add another */
   	KLP_Hide_Msg();
   	parentVal = $("#id_form-0-boundary").val();
   	$("#id_form-buttonType").val('save and add another');
   	KLP_form_submit(parentVal, 'id_form-0-boundary');


   });


   var KLP_form_submit = function(parentVal, parentId){
   	/* post data using post method */
        /* capture new name to change values in node */
    	newName = $('#id_form-0-name').val();
   	$.post(
        	$('#url').val(),
        	$("#institutionForm").serialize(),
                function(data){
                    /* Get Response */
                    $("#dyncData").html(data);
                    // NFInit();
                    $('input:visible:enabled:first').focus();
                    var successStatus = $("#success_status").val();
                    if (successStatus == 'True'){
                    	/* If It success show success msg and update node in tree */
                    	treeNode=$("#institution_{{institution.id}}").find("a:first");
                    	$(treeNode).attr("title", newName);
                    	$("#institution_{{institution.id}}_text").html(newName);
                    	KLP_BredaCrumb(treeNode);
                    	$("#successMsgHead").show();
   		    	$("#klp_MsgTxt").html("{{extra_context|displayValue:'institutionType'}} Updated Successfully")

                    	if (parentId != null)
                    		$("#"+parentId).val(parentVal);
                    }
               }
           );
   }

});
</script>


