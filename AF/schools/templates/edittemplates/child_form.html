{% load template_tags %}
{% if extra_context|displayValue:'replaceTrue'%}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>{{title}}</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript" src="/static_media/js/jquery.js"></script>
<script language="javascript" type="text/javascript" src="/static_media/js/niceforms.js"></script>
<script type="text/javascript" src="/static_media/js/thickbox.js" charset="utf-8"></script>

<link rel="stylesheet" type="text/css" media="all" href="/static_media/css/thickbox.css" charset="utf-8"/>
<link rel="stylesheet" type="text/css" media="all" href="/static_media/css/form.css" />
<link rel="stylesheet" type="text/css" media="all" href="/static_media/css/style.css" />
</head>

<body>
<div id="container">

{% if entry == "Add" %}
<fieldset>
    <legend>{{legend}}</legend>
{% else %}
<div class="tablebg">
{% endif %}
<div id="popData">
{% endif %}

<div class="detailHead">
	<span class="hedText">Edit Form</span>
</div>
<form action="." method="POST" enctype="multipart/form-data" class="niceform" id="childForm" onsubmit="return false;">{% csrf_token %}
	<table class="tblprofile">
		{{form.management_form}}
	 	{% for entryForm in form.forms %}
				<input type="hidden" name="form-buttonType" id="id_form-buttonType" value="save" />
				<input type="hidden" id="success_status" size="15" value="{{extra_context|displayValue:'showsuccess'}}" / >
				<input type="hidden" id="replaceTrue" name="replaceTrue" size="15" value="True" / >
				
				<tr>
				    <td><label class="KLP_required">First Name:</label></td>
				    <td>
					{% render_field entryForm.firstName 'tabindex=1' %}
				    </td><td>
					{% for error in entryForm.firstName.errors %}
						<span class="editErr">{{ error }}</span>
					{% endfor %}
					</td>
				</tr>
				<tr>
				    <td><label class="KLP_required">Last Name:</label></td>
				    <td>
					{% render_field entryForm.lastName 'tabindex=2' %}
				    </td><td>
					{% for error in entryForm.lastName.errors %}
						<span class="editErr">{{ error }}</span>
					{% endfor %}
					</td>
				</tr>
				<tr>
				    <td><label>UID:</label></td>
				    <td>
					{% render_field entryForm.uid 'tabindex=3' %}
				    </td>
				    <td>
                                    	{% for error in entryForm.uid.errors %}
	                                	<span class="editErr">{{ error }}</span>
	                                {% endfor %}
                                    </td>
				</tr>
				<tr>
				    <td><label>Other Studnet Id:</label></td>
				    <td>
					<input type="text" name="form-0-otherId" id="id_form-0-otherId" value="{{child.getStudent.otherStudentId}}" tabindex=3 />
				    </td>
				    
				</tr>
				<tr>
				    <td><label class="KLP_required">Date of Birth:</label></td>
				    <td>
					{% render_field entryForm.dob 'tabindex=3' %}
				    </td>
				    <td>
					{% for error in entryForm.dob.errors %}
						<span class="editErr">{{ error }}</span>
					{% endfor %}
				    </td>
				</tr>
				<tr>
				    <td><label class="KLP_required">Gender:</label></td>
				    <td>
					{% render_field entryForm.gender 'tabindex=4' %}
				    </td><td>
					{% for error in entryForm.gender.errors %}
						<span class="editErr">{{ error }}</span>
					{% endfor %}
					</td>
				</tr>
				<tr>
				    <td><label class="KLP_required">Mother Tongue:</label></td>
				    <td>
					{% render_field entryForm.mt 'tabindex=5' %}{{entryForm.id}}
					<input type="hidden" name="form-0-relations" id="id_relations" size="15" value="{{child.relations.id}}"/>
					<input type="hidden" name="form-0-boundary" id="id_boundary" size="15" value="{{child.boundary.id}}"/>
					<input type="hidden" name="form-0-studentchecked" id="id_studentchecked" size="15" value="{% if extra_context|displayValue:'modelName'%}True{% else %}False{% endif %}"/>
					<input type="hidden" name="form-0-active" id="id_active" size="15" value="2"/>
				    </td><td>
					{% for error in entryForm.mt.errors %}
						<span class="editErr">{{ error }}</span>
					{% endfor %}
					</td>
				</tr>

			    
				
				<tr>
					<td> &nbsp;</td>
					<td>
					{% for error in entryForm.name.errors %}
						<span class="editErr">{{ error }}</span>
					{% endfor %}
					</td>
				</tr>
				<tr>
				    <td><label class="KLP_required">Mother First Name:</label></td>
				    <td>
					<input type="text" name="form-0-motherfirstname" id="id_form-0-motherfirstname" value="{{child.getMother.first_name}}" tabindex="6" />
				    </td>
				</tr>
				<tr>
				    <td><label>Mother Middle Name:</label></td>
				    <td>
					<input type="text" name="form-0-mothermiddlename" id="id_form-0-mother" value="{{child.getMother.middle_name}}" tabindex="6" />
				    </td>
				</tr>
				<tr>
				    <td><label>Mother Last Name:</label></td>
				    <td>
					<input type="text" name="form-0-motherlastname" id="id_form-0-mother" value="{{child.getMother.last_name}}" tabindex="6" />
				    </td>
				</tr>
				<tr>
				    <td><label class="KLP_required">Father First Name:</label></td>
				    <td>
					
					<input type="text" name="form-0-fatherfirstname" id="id_form-0-father" value="{{child.getFather.first_name}}" tabindex="7"/>
					<input type="hidden" name="ModelName" id = "model" value="{{extra_context|displayValue:'modelName'}}" />
					<input type="hidden" name="replace" id = "replace_id" value="{% if extra_context|displayValue:'modelName' %}{{child.getStudent.id}}{% else %}{{child.id}}{% endif %}" />
				    </td>
				</tr>
				<tr>
				    <td><label>Father Middle Name:</label></td>
				    <td>
					<input type="text" name="form-0-fathermiddlename" id="id_form-0-fathermiddlename" value="{{child.getMother.middle_name}}" tabindex="6" />
				    </td>
				</tr>
				<tr>
				    <td><label>Father Last Name:</label></td>
				    <td>
					<input type="text" name="form-0-fatherlastname" id="id_form-0-fatherlastname" value="{{child.getMother.last_name}}" tabindex="6" />
				    </td>
				</tr>
				<tr>
					<td><input type="submit" id="id_save" value="Save" /></td>
					
					<!--td>{% if not extra_context|displayValue:'modelName' %}
					    <input type="submit" name="save_and_continue" id="id_save_and_continue" value="Save And Continue" />
					</td>
					<td>
					    <input type="submit" name="save_and_create" id="id_save_and_create" value="Save And Create Another" />{% endif %}
					</td-->
					
				</tr>
			{% endfor %}
                </table>
</form>
</div>
<script>
  $(document).ready(function(){
     setTimeout(function(){
		$('input:visible:enabled:first').focus();
	},200);

     var KLP_Hide_Msg = function(){
	$("#successMsgHead").hide();
        $("#failureMsgHead").hide();
}

   $("#id_save").click(function(){
	KLP_Hide_Msg();
	parentVal = $("#id_boundary").val();
   	$("#id_form-buttonType").val('save');
   	KLP_form_submit(parentVal,'id_boundary');
   });

   $("#id_save_and_continue").click(function(){
	KLP_Hide_Msg();
	parentVal = $("#id_boundary").val();
   	$("#id_form-buttonType").val('save and continue');
	KLP_form_submit(parentVal,'id_boundary');
   });

   $("#id_save_and_create").click(function(){
	KLP_Hide_Msg();
   	parentVal = $("#id_boundary").val();
   	$("#id_form-buttonType").val('save and add another');
   	KLP_form_submit(parentVal,'id_boundary');
   });

var KLP_form_submit = function(parentVal, parentId){
    modelName=$('#model').val();
    replaceId =  'student_'+$('#replace_id').val()
    $.post(  
        '{{child.get_update_url}}',  
        $("#childForm").serialize(),  
        function(data){
        	$('#popData').html(data);
		NFInit();
		var successStatus = $("#success_status").val();
		if (successStatus == 'True'){
			$('#'+replaceId, self.parent.document).replaceWith(data);
			window.parent.tb_init('#'+replaceId+' a.thickbox, area.thickbox, input.thickbox');
			window.parent.$("#successMsgHead").show();
	   		window.parent.$("#klp_MsgTxt").html("Student Updated Successfully");
			window.parent.tb_remove();
        	} 
    	});  
}
});
</script>

</body>
</html>

